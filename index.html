<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, user-scalable=no">
		
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-title" content="ふがふが ふごふご">
		<meta name="theme-color" content="#ff0000">
		
		<link rel="apple-touch-icon" sizes="144x144" href="https://raw.githubusercontent.com/akashi-suc/pwa_sample/master/images/ico/144.png" />
		<link rel="apple-touch-icon" sizes="152x152" href="https://raw.githubusercontent.com/akashi-suc/pwa_sample/master/images/ico/152.png" />
		
		<link rel="manifest" href="manifest.json">
		<script>
		window.addEventListener('load', function() {	
		  if ('serviceWorker' in navigator) {
		    navigator.serviceWorker.register("service-worker.js")
		      .then(function(registration) {
		        console.log("serviceWorker registed.");
		      }).catch(function(error) {
		        console.warn("serviceWorker error.", error);
		      });
		  }
		  
		  // Chrome用処理
		  if ('permissions' in navigator) {
		  
		  	var ua = navigator.userAgent.toLowerCase();
		  	
		  	// Google Chrome
			var isChrome = (ua.indexOf('chrome') > -1) && (ua.indexOf('edge') == -1);
			// Firefox
			var isFirefox = (ua.indexOf('firefox') > -1);
		  	
		  	var permissionName = 'clipboard-read';
		  	
		  	if(isChrome){
		  		// 許可の確認
			    navigator.permissions.query({name:permissionName}).then(function(result) {
					console.log('Permission ' + result.state);	
					switch(result.state) {
					
						case "granted":	
						case "prompt":
							if(navigator.clipboard){
							    navigator.clipboard.readText()
							    .then(function(text){
							       alert(text); 
							    });
							} else {
								console.log("error");	
							}
						break;
						
						default:
							console.log("Permission Error");
						break;
					
					}
					
				});
			}
		  	
		  	if(isFirefox){
		  		permissionName = 'clipboard-read';
		  		if(navigator.clipboard){
				    navigator.clipboard.readText()
				    .then(function(text){
				       alert(text); 
				    });
				} else {
					console.log("error");	
				}
		  	}
			
			// デバッグ用処理 全ての権限を破棄
			/*
			navigator.permissions.revoke({name:'clipboard-read'})
		    .then((result) => {
		      console.log(result.state);
		    });
			*/
		  }
		  
		});
		</script>
	</head>

	<body>
	
	<!--
		<a href = "https://akashi-suc.github.io/pwa_sample/?token=eJybvNBwhaGRkamFpZHFCncfC8tEA0tfAE2uBnY.">https://akashi-suc.github.io/pwa_sample/?token=eJybvNBwhaGRkamFpZHFCncfC8tEA0tfAE2uBnY.</a><br>
		
		<a href = "https://akashi-suc.github.io/pwa_sample">https://akashi-suc.github.io/pwa_sample</a><br>
	-->

	</body>

</html>
